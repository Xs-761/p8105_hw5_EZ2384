---
title: "p8105_hw5_ez2384"
output: github_document
editor_options: 
  chunk_output_type: inline
---

```{r Load Packages & Set Seed, message=FALSE}

  library(tidyverse)
  library(dplyr)
  library(ggplot2)
  set.seed(1)

```

### Problem 1
  /

### Problem 2
```{r Fix Parameters}
  
  n = 30
  sigma = 5

```

sim_func is a Simulator Function that returns mu_hat and statistical significance level corresponds to each input sample:
```{r Create Simulator Function}

  sim_func = function(sample_size, population_mean, population_std) {
    sim_data = tibble(sample = rnorm(n = sample_size, mean = population_mean, sd = population_std))
    stats  = sim_data %>% summarize(mu_hat = mean(sample))
    t_test = broom::tidy(t.test(sim_data$sample, mu=0)) %>% rename(mu_hat = estimate) %>% select(mu_hat, p.value)
    return(t_test)
  }

```

now simulate 5000 times, for mu in 0-6 respectively
```{r Perform Simulation, cache=TRUE, message=FALSE, warning=FALSE}

  simulation_results = tibble(mu = 0:6) %>% mutate(data = map(.x=mu, ~ rerun(5000, sim_func(sample_size=n, population_mean=.x, population_std=sigma)) %>% bind_rows()))

```

now make the plot showing the proportion of times the null was rejected on the y-axis and the true value of mu on the x-axis.
describe the association between effect size and power
```{r Power Results & Plot showing the mu-power relationship, message=FALSE, warning=FALSE}

  power_results = simulation_results %>% mutate(power = map_dbl(.x=data, ~ mean(.x$p.value < 0.05))) %>% select(mu, power)
  
  ggplot(power_results, aes(x = mu, y = power)) +
    geom_line(size=0.3) +
    geom_point(size=0.5) +
    labs(
      title = "Power of the Test vs. True Value of μ",
      x = "True Value of μ",
      y = "Power (Proportion of Null Rejections)"
    ) +
    theme_light() +
    theme(plot.title = element_text(hjust = 0.5)) +
    scale_x_continuous(breaks = 0:6) +
    scale_y_continuous(breaks = seq(0, 1, by = 0.05))

```

#### Discussion on plot of true population mean against statistical power   
- When μ=0, the power is close to 0.05, which matches the significance level (alpha) of 0.05. This is expected because when the null hypothesis is true, the probability of rejecting it (Type I error rate) is equal to the significance level.    
- As μ moves further away from 0, the power increases steadily. This is because as the true mean μ diverges from the null hypothesis mean of 0, the effect size increases, making it easier for the test to detect a significant difference. Consequently, the likelihood of rejecting the null hypothesis rises.    
- Asymptotic Power (Power Approaching 1): At higher values of μ (around 4 to 6), the power approaches 1. This indicates that the test is almost always able to detect the difference from the null hypothesis when the true mean is substantially different from 0.   
- Conclusion: This plot correctly reflects the association between effect size (distance between the true μ and the null hypothesis mean) and power as it shows that 
Small effect sizes result in low power whereas larger effect sizes result in higher power. This result confirms that the test is more powerful as the effect size increases,


### Problem 3